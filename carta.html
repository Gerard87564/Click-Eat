<!DOCTYPE html>
<html lang="es">
    <head>
        <title>Click&Eat</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Click&Eat">
        <meta name="keywords" content="disseny de pagines web, web, desenvolupament web">
        <meta name="author" content="Gerard">
        <link rel="shortcut icon" href="./IMG's/IMG-20240924-WA0002-removebg-preview_1.png">
        <link rel="stylesheet" href="./CSS/carta.css">
        <link href='https://fonts.googleapis.com/css?family=Fredoka One' rel='stylesheet'>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://kit.fontawesome.com/f2dbf97883.js" crossorigin="anonymous"></script>
    </head>
    
    <body>
        <header>
            <nav class="col-12 col-lg-12 col-dm-12 col-sm-12">
                <div id="img-nav">
                    <img src="./IMG's/pixelcut-export (3).png" alt="logo">                      
                    <ul id="htopnav">
                        <button class="btn" onclick="inici()"><p>INICI</p></button>
                        <button class="btn" onclick="carta()"><p>CARTA</p></button>
                        <button class="btn" onclick="trbNosaltres()"><p>TREBALLA AMB NOSALTRES</p></button>
                        <button class="btn" onclick="contacte()"><p>CONTACTE</p></button>
                    </ul>

                    <div id="hamburger-menu">
                        <div id="bar"></div>
                    </div>  
                </div>
            </nav>
        </header>

        <main>
            <div id="seccio-principal">
                <p id="info-mesa"></p>                            
            </div>
            <section id="wrap">
                <div class="wrap-title-section">
                    <h2>Hamburgueses</h2>
                </div>
                <div class="wrap column-2 carta">
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/chicken.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Chicken</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>9€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/lomo.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Lomo</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>9€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/vacuno.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Boví</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>11€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/classica.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Classica</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>12€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                </div>

                <div class="wrap-title-section">
                    <h2>Complements</h2>
                </div>
                <div class="wrap column-2 carta">
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/nugget.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Nuggets</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>6€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/alitas.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Aletes de pollastre</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>7€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/patates-fregides.webp" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Patates</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>6€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                </div>

                <div class="wrap-title-section">
                    <h2>Ensalades</h2>
                </div>
                <div class="wrap column-2 carta">
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/Ensalada-Pollo.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Ensalada pollastre</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>8€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/ensalada-arroz.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Ensalada d'arros</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>8€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/ensalada-pasta.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Ensalada de pasta</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>8€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/ensalada.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Ensalada tradicional</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>8€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                </div>

                <div class="wrap-title-section">
                    <h2>Menus</h2>
                </div>
                <div class="wrap column-2 carta">
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/infantil.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Infantil</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>9€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/celiaco.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Celiac</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>9€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                    <div class="plato-carta">
                        <div class="img-plato-carta">
                            <img src="./IMG's/vegano.png" alt="hamburguer1">
                        </div>
                        <div class="title-plato-carta">
                            <h4>Vegà</h4>
                        </div>
                        <div class="precio-plato-carta">
                            <span>9€</span>
                        </div>
                        <div class="disponibilidad">
                            <div class="barra-disponibilidad"></div>
                        </div>
                        <i class="fa-solid fa-cart-shopping add-to-cart"></i>
                        <p class="count"></p>
                    </div>
                </div>
            </section>

            <form id="orderForm">
                <label for="menuId">Omple les dades:</label>
                <input type="text" id="dni" name="dni" placeholder="Ingressa el dni...">
                <input type="text" id="nom" name="nom" placeholder="Ingressa el teu nom...">
                <input type="text" id="cognom" name="cognom" placeholder="Ingressa el teu cognom...">
                <input type="tel" id="tlf" name="tlf" placeholder="Ingressa el numero de telefon...">
                <input type="email" id="correu" name="correu" placeholder="Ingressa el email...">
            </form> 

            <div id="cart-container">
                <h2>Carrito</h2>
                <ul id="cart-list"></ul>
                <button id="submit-order">Realizar pedido</button>
            </div>
        </main>

        <footer>
            <div id="footer-content">
                <img id="telephone" src="./IMG's/455705.png" alt="telephone">
                <p id="number">964324567</p>
                <p id="copy">Click&Eat 2024&copy;, All rights reserved</p>
                <img id="x" src="./IMG's/x-social-media-black-icon.png" alt="x">
                <img id="insta" src="./IMG's/black-instagram-icon.webp" alt="instagram">
            </div>
        </footer>
        <script src="./JS/script.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                let cart = [];
                
                function addToCart(itemId, itemName, itemPrice, menuID) {
                    const item = {
                        id: itemId,
                        name: itemName,
                        price: itemPrice,
                        quantity: 1,
                        menuID: menuID
                    };

                    const existingItem = cart.find(product => product.id === itemId && product.menuID === menuID);
                    if (existingItem) {
                        existingItem.quantity += 1;
                    } else {
                        cart.push(item);
                    }

                    updateCartDisplay();
                }

                function updateCartDisplay() {
                    const cartList = document.getElementById('cart-list');
                    cartList.innerHTML = ''; 

                    cart.forEach(item => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${item.name} - ${item.quantity} x ${item.price}€`; 
                        cartList.appendChild(listItem);  
                    });
                }
                
                fetch("https://api.clickeat.cat/menus")
                    .then(response => response.json())
                    .then(data => {
                        console.log("Datos completos de la API:", data);
                        
                        data.forEach(item => {
                            const itemMenuID = item.MenuID;
                            const itemName = item.Nombre;

                            if (itemName) {
                                document.querySelectorAll('.plato-carta').forEach(plato => {
                                    const titulo = plato.querySelector('h4');
                                    
                                    if (titulo && titulo.textContent.trim().toLowerCase() === itemName.toLowerCase()) {
                                        plato.setAttribute('data-menu-id', itemMenuID);

                                        const barra = plato.querySelector('.barra-disponibilidad');
                                        if (barra) {
                                            const pItem = plato.querySelector('.count');
                                            barra.style.width = item.disponible + "%";
                                            if (pItem) {
                                                pItem.textContent = item.disponible + " uds";
                                            }

                                            barra.style.backgroundColor = 
                                                item.disponible > 50 ? "#4caf50" : 
                                                (item.disponible > 20 ? "orange" : "red");
                                        }
                                    }
                                });
                            }
                        });

                        document.querySelectorAll('.add-to-cart').forEach(button => {
                            button.addEventListener('click', (e) => {
                                const parent = e.target.closest('.plato-carta');
                                const itemId = parent.getAttribute('data-id');
                                const itemName = parent.querySelector('h4').textContent;
                                const itemPrice = parseFloat(parent.querySelector('.precio-plato-carta span').textContent);
                                const menuID = parent.getAttribute('data-menu-id');
                                
                                addToCart(itemId, itemName, itemPrice, menuID);
                            });
                        });
                    })
                    .catch(error => console.error('Error al obtener la disponibilidad:', error));

                    function getParameterByName(name) {
                        const url = window.location.search;
                        const params = new URLSearchParams(url);
                        return params.get(name);
                    }
                    const numeroMesa = getParameterByName('mesa');

                    document.getElementById('submit-order').addEventListener('click', function(event) {
                        event.preventDefault();

                        const dni = document.getElementById('dni').value;
                        const nom = document.getElementById('nom').value;
                        const cognom = document.getElementById('cognom').value;
                        const tlf = document.getElementById('tlf').value;
                        const correu = document.getElementById('correu').value;

                        if (cart.length === 0) {
                            alert("Por favor, agrega productos al carrito antes de hacer el pedido.");
                            return;
                        }

                        const menuIDs = Array.isArray(cart) ? cart.map(item => item.menuID).flat() : [cart.menuID];
                        console.log('MenuIDs a enviar:', menuIDs);

                        const orderData = {
                            MenuID: menuIDs, 
                            DNI: dni,
                            Nom: nom,
                            Cognom: cognom,
                            Tlf: tlf,
                            Correu: correu,
                        };

                        if (numeroMesa!=undefined) {
                            orderData.Taula = numeroMesa;
                        }

                        localStorage.setItem('pedido', JSON.stringify(orderData));
                        window.location.href = 'comanda.html';  
                    });
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                function getParameterByName(name) {
                    const url = window.location.search;
                    const params = new URLSearchParams(url);
                    return params.get(name);
                }

                const numeroMesa = getParameterByName('mesa');

                if (numeroMesa) {
                    const infoMesa = document.getElementById("info-mesa");
                    infoMesa.textContent = `Has escollit la taula ${numeroMesa}, selecciona el teu menu:`;
                } else {
                    console.warn("Parámetro 'mesa' no encontrado en la URL.");
                }

                const buttonSubmit= document.querySelector('button');

                buttonSubmit.addEventListener("click", function () {
                    redireccionarComanda();
                });
            });
        </script>
    </body>
</html>